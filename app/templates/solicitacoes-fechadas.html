{% extends "layouts/app.html" %}
{% block title %}Solicitações Fechadas{% endblock %}

{% block page_title %}
<div class="d-flex align-items-center w-100">
  <span class="me-auto">
  WorkCost · Solicitações de Extra — Fechadas
  </span>

  <div class="ms-auto d-flex gap-2">

    <a href="{{ url_for('pages.solicitacoes') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Voltar
    </a>    

    <a href="{{ url_for('pages.solicitacoes_abertas') }}" class="btn btn-outline-primary">
      <i class="bi bi-file-earmark-medical"></i> Abertas
    </a>

    <a href="{{ url_for('pages.solicitacoes_fechadas') }}" class="btn btn-outline-success active">
      <i class="bi bi-file-earmark-medical"></i> Fechadas
    </a>

    <button class="btn btn-outline-purple" type="button" onclick="toggleFullscreen()">
      <i class="bi bi-arrows-fullscreen"></i>
    </button>

    <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger">
      <i class="bi bi-box-arrow-right"></i> Sair
    </a>
  </div>
</div>
{% endblock %}

{% block content %}
<link rel="stylesheet"
      href="{{ url_for('static', filename='css/solicitacoes.css') }}">

<div class="card shadow-sm p-4">

  <div class="d-flex justify-content-between mb-3 gap-2 flex-wrap">
    <input id="filterSearch" class="form-control w-25" placeholder="Pesquisar...">

    <div class="d-flex gap-2">
      <input type="date" id="filterStartDate" class="form-control">
      <input type="date" id="filterEndDate" class="form-control">
    </div>
  </div>

  <table class="table table-bordered align-middle text-center">
    <thead>
      <tr>
        <th>ID</th>
        <th>Data</th>
        <th>Realização</th>
        <th>Solicitante</th>
        <th>Objetivo</th>
        <th>Observações</th>
        <th>Previsto</th>
        <th>Real</th>
        <th>Acessar</th>
      </tr>
    </thead>

    <tbody>
      {% for s in solicitacoes %}
      <tr>
        <td>{{ s.id }}</td>
        <td>{{ s.data.strftime("%d/%m/%Y") }}</td>
        <td>{{ s.data_execucao.strftime("%d/%m/%Y") }}</td>
        <td>{{ s.solicitante }}</td>

        <td>
          <select class="form-select form-select-sm objetivo-select"
                  data-id="{{ s.id }}">
            <option value="">Selecionar</option>
            <option value="nao"
              {% if s.objetivo_status == 'nao' %}selected{% endif %}>
              Não
            </option>
            <option value="parcial"
              {% if s.objetivo_status == 'parcial' %}selected{% endif %}>
              Parcialmente
            </option>
            <option value="sim"
              {% if s.objetivo_status == 'sim' %}selected{% endif %}>
              Sim
            </option>
          </select>
        </td>
        
        <td>
          <input type="text"
                 class="form-control form-control-sm observacao-input"
                 data-id="{{ s.id }}"
                 value="{{ s.observacoes or '' }}"
                 placeholder="Observação...">
        </td>

        <td>{{ s.efetivo_previsto }}</td>
        <td>{{ s.efetivo_real }}</td>

        <td>
          <select class="form-select form-select-sm select-acessar-fechadas"
                  data-pdf="{{ url_for('pages.solicitacao_documento', solicitacao_id=s.id) }}"
                  data-frequencia="{{ url_for('pages.solicitacao_frequencia', solicitacao_id=s.id) }}">
            <option value="">Selecionar</option>
            <option value="pdf">PDF</option>
            <option value="frequencia">Frequência</option>
          </select>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>

<script src="{{ url_for('static', filename='js/solicitacoes-fechadas.js') }}"></script>
{% endblock %}
