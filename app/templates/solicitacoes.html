{% extends "layouts/app.html" %}
{% block title %}Solicitações{% endblock %}

{% block page_title %}
<div class="d-flex align-items-center w-100">
  <span class="me-auto">
    WorkCost · Solicitações
  </span>

  <div class="ms-auto d-flex gap-2">

    <a href="{{ url_for('pages.solicitacoes_abertas') }}" class="btn btn-outline-primary">
      <i class="bi bi-file-earmark-medical"></i> Abertas
    </a>

    <a href="{{ url_for('pages.solicitacoes_fechadas') }}" class="btn btn-outline-success">
      <i class="bi bi-file-earmark-medical"></i> Fechadas
    </a>

    <button class="btn btn-outline-purple" type="button" onclick="toggleFullscreen()">
      <i class="bi bi-arrows-fullscreen"></i>
    </button>

    <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger">
      <i class="bi bi-box-arrow-right"></i> Sair
    </a>
  </div>
</div>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/solicitacoes.css') }}">

<div class="page-title-solicitacoes text-center mb-4">
  <div class="fw-bold">
    FORMULÁRIO DE CONTROLE DE EXTRA JORNADA
  </div>
  <small class="text-muted">
    Overtime Control Form
  </small>
</div>

<form id="formSolicitacao"
      data-mode="{{ modo | default('create') }}">
  <input type="hidden" name="funcionarios_json" id="funcionariosJson">

  <!-- =======================
       DADOS GERAIS
       ======================= -->
  <div class="card p-4 shadow-sm mb-4">
    <div class="row g-4">

      <!-- DATA -->
      <div class="col-md-3">
        <label class="form-label fw-bold">
          Data <small class="text-muted">/ Date</small>
        </label>
        <input type="date"
               name="data"
               class="form-control"
               value="{{ solicitacao.data if modo == 'view' else now().date() }}"
               {% if modo == 'view' %}disabled{% endif %}
               required>
      </div>

      <!-- TURNO -->
      <div class="col-md-5">
        <label class="form-label fw-bold d-block">
          Turno <small class="text-muted">/ Shift</small>
        </label>

        <div class="d-flex gap-3 mt-1">
          {% for t in ['1T','2T','3T'] %}
          <div class="form-check">
            <input class="form-check-input turno-radio"
                   type="radio"
                   name="turnos"
                   value="{{ t }}"
                   {% if modo == 'view' and t in solicitacao.turnos %}checked{% endif %}
                   {% if modo == 'view' %}disabled{% endif %}>
            <label class="form-check-label">{{ t }}</label>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- CLIENTE -->
      <div class="col-md-4">
        <label class="form-label fw-bold">
          Cliente <small class="text-muted">/ Client</small>
        </label>
        <select name="cliente"
                class="form-select"
                {% if modo == 'view' %}disabled{% endif %}>
          {% for c in ['VAC','VTE','VTT'] %}
          <option value="{{ c }}"
            {% if modo == 'view' and solicitacao.cliente == c %}selected{% endif %}>
            {{ c }}
          </option>
          {% endfor %}
        </select>
      </div>

      <!-- SETORES -->
      <div class="col-md-8">
        <label class="form-label fw-bold">
          Setores envolvidos <small class="text-muted">/ Departments</small>
        </label>

        <div class="multiselect" id="setoresSelect">
          <div class="multiselect-display" id="setoresDisplay">
            {% if modo == 'view' %}
              {{ solicitacao.setores }}
            {% else %}
              Selecione um ou mais setores envolvidos nesta extra
            {% endif %}
          </div>

          {% if modo != 'view' %}
          <div class="multiselect-options">
            {% for setor in [
              'Direção','Engenharia','Estoque','Manutenção','PCP','Produção','TI'
            ] %}
              <label class="multiselect-option">
                <input type="checkbox" value="{{ setor }}" name="setores">
                <span>{{ setor }}</span>
              </label>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- DESCRIÇÃO -->
      <div class="col-md-4">
        <label class="form-label fw-bold">
          Descrição <small class="text-muted">/ Description</small>
        </label>
        <select name="descricao"
                class="form-select"
                {% if modo == 'view' %}disabled{% endif %}>
          {% for d in ['Hora Extra','Banco de Horas','Compensação'] %}
          <option value="{{ d }}"
            {% if modo == 'view' and solicitacao.descricao == d %}selected{% endif %}>
            {{ d }}
          </option>
          {% endfor %}
        </select>
      </div>

    </div>
  </div>

<!-- FUNCIONÁRIOS -->
<h5 class="fw-bold">
  Lista de Funcionários <small class="text-muted">/ Employee List</small>
</h5>

<table class="table table-bordered align-middle" id="funcionariosTable">
  <thead>
    <tr>
      <th>Item</th>
      <th>Matrícula</th>
      <th>Colaborador</th>
      <th>Endereço</th>
      <th>Telefone</th>
      <th>Início</th>
      <th>Término</th>
      <th>Transporte</th>
      <th>Assinatura</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
  {% if modo == 'view' %}
    {% for f in funcionarios %}
    <tr>
      <td>{{ loop.index }}</td>
      <td><input class="form-control" value="{{ f.matricula }}" disabled></td>
      <td><input class="form-control" value="{{ f.nome }}" disabled></td>
      <td><input class="form-control" value="{{ f.endereco }}" disabled></td>
      <td><input class="form-control" value="{{ f.telefone }}" disabled></td>
      <td><input class="form-control" value="{{ f.inicio }}" disabled></td>
      <td><input class="form-control" value="{{ f.termino }}" disabled></td>
      <td><input class="form-control" value="{{ f.transporte }}" disabled></td>
      <td>
        <div class="signature-box signed">{{ f.nome }}</div>
      </td>
      <td></td>
    </tr>
    {% endfor %}
  {% endif %}
  </tbody>
</table>

{% if modo != 'view' %}
<button type="button" class="btn btn-secondary btn-add-row mb-3" id="btnAddRow">
  Adicionar linha
</button>
{% endif %}

<div class="mb-4">
  <label class="fw-semibold">
    Atividades a realizar <small class="text-muted">/ Activities</small>
  </label>
  <textarea name="atividades"
            class="form-control"
            rows="3"
            {% if modo == 'view' %}disabled{% endif %}>{{ solicitacao.atividades if modo == 'view' }}</textarea>
</div>

{% if modo != 'view' %}
<button class="btn btn-primary w-100">
  Registrar Solicitação
</button>
{% endif %}
</form>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/solicitacoes.js') }}"></script>
{% endblock %}
