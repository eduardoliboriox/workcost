{% extends "layouts/app.html" %}
{% block title %}Solicitações{% endblock %}

{% block page_title %}
<div class="d-flex align-items-center w-100">
  <span class="me-auto">
    WorkCost · Solicitações
  </span>

  <div class="ms-auto d-flex gap-2">

    <a href="{{ url_for('pages.solicitacoes_abertas') }}" class="btn btn-outline-warning">
      <i class="bi bi-file-earmark-medical"></i> Abertas
    </a>

    <a href="{{ url_for('pages.solicitacoes_fechadas') }}" class="btn btn-outline-warning">
      <i class="bi bi-file-earmark-medical"></i> Fechadas
    </a>

    <button class="btn btn-outline-purple" type="button" onclick="toggleFullscreen()">
      <i class="bi bi-arrows-fullscreen"></i>
    </button>

    <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger">
      <i class="bi bi-box-arrow-right"></i> Sair
    </a>
  </div>
</div>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/solicitacoes.css') }}">

<div class="page-title-solicitacoes text-center mb-4">
  <div class="fw-bold">
    FORMULÁRIO DE CONTROLE DE EXTRA JORNADA
  </div>
  <small class="text-muted">
    Overtime Control Form
  </small>
</div>

<form id="formSolicitacao" method="post" action="{{ url_for('api.api_criar_solicitacao') }}">
  <input type="hidden" name="funcionarios_json" id="funcionariosJson">

  <!-- =======================
       DADOS GERAIS
       ======================= -->
  <div class="card p-4 shadow-sm mb-4">
    <div class="row g-4">

      <!-- DATA -->
      <div class="col-md-3">
        <label class="form-label fw-bold">
          Data <small class="text-muted">/ Date</small>
        </label>
        <input type="date"
               name="data"
               class="form-control"
               value="{{ now().date() }}"
               required>
      </div>

      <!-- TURNO -->
      <div class="col-md-5">
        <label class="form-label fw-bold d-block">
          Turno <small class="text-muted">/ Shift</small>
        </label>

        <div class="d-flex gap-3 mt-1">
          <div class="form-check">
            <input class="form-check-input turno-radio"
                   type="radio"
                   name="turnos"
                   value="1T">
            <label class="form-check-label">1º Turno</label>
          </div>

          <div class="form-check">
            <input class="form-check-input turno-radio"
                   type="radio"
                   name="turnos"
                   value="2T">
            <label class="form-check-label">2º Turno</label>
          </div>

          <div class="form-check">
            <input class="form-check-input turno-radio"
                   type="radio"
                   name="turnos"
                   value="3T">
            <label class="form-check-label">3º Turno</label>
          </div>
        </div>
      </div>

      <!-- CLIENTE -->
      <div class="col-md-4">
        <label class="form-label fw-bold">
          Cliente <small class="text-muted">/ Client</small>
        </label>
        <select name="cliente" class="form-select">
          <option>VAC</option>
          <option>VTE</option>
          <option>VTT</option>
        </select>
      </div>

      <!-- SETORES -->
      <div class="col-md-8">
        <label class="form-label fw-bold">
          Setores envolvidos <small class="text-muted">/ Departments</small>
        </label>

        <div class="multiselect" id="setoresSelect">
          <div class="multiselect-display" id="setoresDisplay">
            Selecione um ou mais setores envolvidos nesta extra
          </div>

          <div class="multiselect-options">
            {% for setor in [
              'Direção',
              'Engenharia',
              'Estoque',
              'Manutenção',
              'PCP',
              'Produção',
              'TI'
            ] %}
              <label class="multiselect-option">
                <input type="checkbox"
                       value="{{ setor }}"
                       name="setores">
                <span>{{ setor }}</span>
              </label>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- DESCRIÇÃO -->
      <div class="col-md-4">
        <label class="form-label fw-bold">
          Descrição <small class="text-muted">/ Description</small>
        </label>
        <select name="descricao" class="form-select">
          <option value="Hora Extra">Hora Extra / Overtime</option>
          <option value="Banco de Horas">Banco de Horas / Time Bank</option>
          <option value="Compensação">Compensação / Compensation</option>
        </select>
      </div>

    </div>
  </div>

<!-- FUNCIONÁRIOS -->
<h5 class="fw-bold">
  Lista de Funcionários <small class="text-muted">/ Employee List</small>
</h5>

  <table class="table table-bordered align-middle" id="funcionariosTable">
    <thead>
      <tr>
        <th>Item</th>
        <th><div>Matrícula</div><small class="text-muted">employee code</small></th>
        <th><div>Colaborador</div><small class="text-muted">employee</small></th>
        <th><div>Endereço</div><small class="text-muted">address</small></th>
        <th><div>Telefone</div><small class="text-muted">phone</small></th>
        <th><div>Início</div><small class="text-muted">start</small></th>
        <th><div>Término</div><small class="text-muted">end</small></th>
        <th><div>Transporte</div><small class="text-muted">transport</small></th>
        <th><div>Assinatura</div><small class="text-muted">signature</small></th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>


  <small class="text-muted d-block mb-4">
    A assinatura do colaborador formaliza a ciência quanto à solicitação de horas extras,
    assegurando o devido registro e o cumprimento dos trâmites administrativos previstos.
  </small>

  <button type="button" class="btn btn-secondary btn-add-row mb-3" id="btnAddRow">
    Adicionar linha
  </button>

  <div class="mb-4">
    <label class="fw-semibold">
      Atividades a realizar <small class="text-muted">/ Activities</small>
    </label>
    <textarea name="atividades" class="form-control" rows="3"></textarea>
  </div>

  
  <!-- =======================
       FLUXO DE APROVAÇÃO
       ======================= -->
  <h5 class="fw-bold mt-4">
    Fluxo de Aprovação <small class="text-muted">/ Approval</small>
  </h5>
  
  <div class="row justify-content-center g-4 mt-3 approval-flow">
    {% for role in [
      'Solicitante',
      'Gestor',
      'Gerente da Planta',
      'Controladoria',
      'Diretoria'
    ] %}
    <div class="col-md-2 text-center approval-item" data-role="{{ role }}">
      <div class="approval-box pending mb-1">
        {{ role }}
      </div>
      
      <div class="approval-input-wrapper">
        <input type="password"
               class="form-control form-control-sm approval-password mb-1"
               placeholder="Senha">
      </div>
      
      <button type="button"
              class="btn btn-sm btn-outline-success btn-approve">
        CONFIRMAR
      </button>

    </div>
    {% endfor %}
  </div>

  <hr class="my-4">

  <div class="row align-items-center g-3 mb-4">
    <div class="col-md-4">
      <label class="fw-bold">
        RECEBIDO EM <small class="text-muted">(Received date)</small>
      </label>
      <input type="date" class="form-control">
    </div>

    <div class="col-md-4 text-center">
      <div class="approval-box pending">
        Recursos Humanos
      </div>
      <input type="password"
             class="form-control form-control-sm mt-2"
             placeholder="Senha RH">
    </div>

    <div class="col-md-4">
      <label class="fw-bold">
        LANÇADO <small class="text-muted">(Launched)</small>
      </label>
      <input type="text" class="form-control">
    </div>
  </div>

  <button class="btn btn-primary w-100">
    Registrar Solicitação
  </button>
</form>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/solicitacoes.js') }}"></script>
{% endblock %}
