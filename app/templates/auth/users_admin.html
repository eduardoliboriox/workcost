{% extends "layouts/app.html" %}
{% block title %}Administração de Usuários{% endblock %}
{% block page_title %}
<div class="d-flex align-items-center w-100">
  <span class="me-auto">
    Venttos - Factory Metrics - Administração de Usuários - Pendentes
  </span>

  <div class="ms-auto d-flex gap-2">
    <a href="{{ url_for('pages.dashboard') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Voltar
    </a>

    {% if current_user.is_authenticated and current_user.is_admin %}
    <a href="{{ url_for('auth.admin_users') }}"
       class="btn btn-outline-primary active">
      <i class="bi bi-shield-lock"></i> Usuários pendentes
    </a>
    {% endif %}

    {% if current_user.is_authenticated and current_user.is_admin %}
    <a href="{{ url_for('auth.admin_users_all') }}"
       class="btn btn-outline-success">
      <i class="bi bi-list-ul"></i> Todos os usuários
    </a>
    {% endif %} 

    <button class="btn btn-outline-purple"
            type="button"
            onclick="toggleFullscreen()">
      <i class="bi bi-arrows-fullscreen"></i>
    </button>

    {% if current_user.is_authenticated %}
    <a href="{{ url_for('auth.logout') }}"
       class="btn btn-outline-danger">
      <i class="bi bi-box-arrow-right"></i> Sair
    </a>
    {% endif %}
  
  </div>
</div>
{% endblock %}

{% block content %}
<div class="card shadow-sm p-3">

  <div class="d-flex mb-3">
    <input type="text"
           id="search"
           class="form-control me-2"
           placeholder="Buscar por nome, usuário ou setor">
    <i class="bi bi-search fs-4 text-muted"></i>
  </div>

  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th>Usuário</th>
        <th>Nome</th>
        <th>Setor</th>
        <th>Status</th>
        <th class="text-end">Ações</th>
      </tr>
    </thead>
    <tbody id="usersTable">
      {% for u in users %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.full_name }}</td>
        <td>{{ u.setor }}</td>
        <td>
          {% if u.is_active %}
            <span class="badge bg-success">Ativo</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendente</span>
          {% endif %}
        </td>
        <td class="text-end">
          {% if not u.is_active %}
          <a href="{{ url_for('auth.approve_user_route', user_id=u.id) }}"
             class="btn btn-sm btn-outline-success">
            Aprovar
          </a>
          
          <a href="{{ url_for('auth.reject_user_route', user_id=u.id) }}"
             class="btn btn-sm btn-outline-danger">
            Negar
          </a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>

<script>
document.getElementById("search").addEventListener("input", function () {
  const value = this.value.toLowerCase();
  document.querySelectorAll("#usersTable tr").forEach(row => {
    row.style.display = row.innerText.toLowerCase().includes(value)
      ? "" : "none";
  });
});
</script>
{% endblock %}
